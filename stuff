stages:
  - build
  - test
  - deploy
  - generate
  - trigger

# build_job:
#   stage: build
#   script:
#     - echo "Building the project..."

# test_job:
#   stage: test
#   script:
#     - echo "Running tests..."

# deploy_job:
#   stage: deploy
#   script:
#     - echo "Deploying the project..."

generate_child_pipeline:
  stage: generate
  script:
    - |
      cat <<EOT > child-pipeline.yml
      stages:
        - child_build
        - child_test

      child_build_job:
        stage: child_build
        script:
          - echo "Building the child project..."

      child_test_job:
        stage: child_test
        script:
          - echo "Running child tests..."
      EOT
  artifacts:
    paths:
      - child-pipeline.yml

trigger_child_pipeline:
  stage: trigger
  needs:
    - generate_child_pipeline
  trigger:
    include: 
      - artifact: child-pipeline.yml
        job: generate_child_pipeline
    strategy: depend
