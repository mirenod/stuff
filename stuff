#!/bin/bash

USERNAME="<username>"
THRESHOLD_DAYS=90

# Get the current date in seconds since epoch
CURRENT_DATE=$(date +%s)

# List access keys and their creation dates
aws iam list-access-keys --user-name $USERNAME --query 'AccessKeyMetadata[*].[AccessKeyId,CreateDate]' --output text | while read -r ACCESS_KEY_ID CREATE_DATE; do
    # Convert the creation date to seconds since epoch
    CREATE_DATE_EPOCH=$(date -d $CREATE_DATE +%s)
    
    # Calculate the age of the access key in days
    AGE_DAYS=$(( (CURRENT_DATE - CREATE_DATE_EPOCH) / 86400 ))
    
    # Check if the age is greater than the threshold
    if [ $AGE_DAYS -gt $THRESHOLD_DAYS ]; then
        echo "Access key $ACCESS_KEY_ID is older than $THRESHOLD_DAYS days."
    fi
done
